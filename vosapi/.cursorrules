# ========================================================
# VOS Backend API – Cursor Rules
# Vendor Onboarding System (Spring Boot 3.5.4)
# ========================================================

###########################################################
# Project Overview
###########################################################
This project is the backend for VOS (Vendor Onboarding System).  
It manages:
- Vendor onboarding invitations
- Secure token + OTP login for vendors
- Multi-step onboarding form submission
- Document uploads + PDF validation
- Procurement dashboard with list, stats, and detail view
- Automated and manual follow-ups
- Email notifications using AWS SNS
- Activity logging for full audit trace

###########################################################
# Tech Stack
###########################################################
Language: Java 17  
Framework: Spring Boot 3.5.4  
Build Tool: Gradle  
Database: PostgreSQL (AWS RDS), H2 for local/testing  
Messaging/Email: AWS SNS  
Security: Spring Security  
Documentation: OpenAPI 3  
Testing: JUnit 5 + Mockito  
Validation: Jakarta Validation  
Libraries: PDFBox, MapStruct, Lombok (optional)  

###########################################################
# Architecture
###########################################################
- Strict layered architecture:
    Controller → Service → Repository → Domain
- Controllers must use DTOs only (never expose entities)
- Services contain business logic
- Repositories access the database
- Domain models represent persistent entities
- Clean separation of concerns

###########################################################
# Package Structure
###########################################################
com.vos/
  config/
  controller/
  domain/
  enums/
  exception/
  model/
  mapper/
  repository/
  security/
  service/
  service/impl/
  util/
  activity/

###########################################################
# Domain Entities
###########################################################
Vendor:
  id, name, email, category, status,
  inviteToken, inviteTokenExpiry,
  createdAt, updatedAt,
  onboardingForm(1:1),
  files(1:N),
  followUps(1:N),
  activityLogs(1:N)

VendorOnboardingForm:
  Embedded: businessDetails, contactDetails, bankingDetails, complianceDetails

VendorFile:
  id, vendorId, type, fileName, storageKey,
  validationStatus, uploadedAt

FollowUp:
  id, vendorId, type, issueSummary, fieldsImpacted,
  status, triggeredBy, emailBody,
  createdAt, updatedAt

ActivityLog:
  id, vendorId, timestamp, eventType, description, metadataJSON

###########################################################
# API Endpoints  (Base: /api/v1)
###########################################################

# Invitations
POST /api/v1/vendor-requests
GET  /api/v1/vendor-requests/{id}

# Vendor Auth (Public)
GET  /api/v1/vendor-sessions/{token}
POST /api/v1/vendor-sessions/{token}/otp/send
POST /api/v1/vendor-sessions/{token}/otp/verify

# Onboarding Form
PUT  /api/v1/vendors/{vendorId}/onboarding
POST /api/v1/vendors/{vendorId}/files

# Procurement Dashboard
GET /api/v1/vendors
GET /api/v1/vendors/{vendorId}
GET /api/v1/vendors/{vendorId}/activity-log
GET /api/v1/vendors/metrics

# Follow-ups
POST  /api/v1/vendors/{vendorId}/follow-ups
GET   /api/v1/vendors/{vendorId}/follow-ups
PATCH /api/v1/follow-ups/{followUpId}

###########################################################
# Security Rules
###########################################################
- Vendor onboarding token/OTP endpoints are PUBLIC
- Procurement/dashboard endpoints MUST require authentication
- Use constructor injection only
- Validate all inputs
- Sanitize all input strings
- Never log sensitive data

###########################################################
# File Handling Rules
###########################################################
- Multipart file upload for PDFs
- Save metadata in DB, content in local/S3
- Validate PDFs using PDFBox
- Maintain validation status on VendorFile

###########################################################
# AWS SNS Notification Rules
###########################################################
- SNS must handle:
    Invitation emails
    OTP emails
    Follow-up emails
- NotificationService must implement:
    sendEmail(String to, String subject, String body)
- SNS region and topic ARN must be externalized

###########################################################
# Testing Requirements
###########################################################
- Use JUnit 5 + Mockito
- Target 80% coverage
- Required tests for:
    VendorRequestService
    OTP flow
    Onboarding form logic
    Follow-up creation
    File validation logic
- Integration tests use @SpringBootTest + H2

###########################################################
# REST API Standards
###########################################################
- JSON only
- Follow OpenAPI spec
- Use DTOs only
- Proper HTTP codes
- X-Correlation-Id included
- Global exception handling with @ControllerAdvice

###########################################################
# Logging
###########################################################
- SLF4J logging
- No sensitive data logs
- ActivityLog for business events
- Correlation ID required

###########################################################
# Build Commands
###########################################################
./gradlew build
./gradlew bootRun
./gradlew test

###########################################################
# Cursor AI Assistant Rules
###########################################################
- Always use:
    Spring Boot 3.5.4  
    Java 17  
    Gradle  
    PostgreSQL  
    AWS SNS  
    PDFBox  
    DTOs  
    MapStruct  
- Always follow layered architecture
- NEVER expose entities in controllers
- NEVER hardcode secrets
- ALWAYS sanitize inputs
- ALWAYS produce production-quality code
- ALWAYS follow these rules strictly

# END OF VOS RULES
